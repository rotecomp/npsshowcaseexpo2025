<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏° NPS Showcase Expo 2025</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, collection, getDocs, query, where, limit, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Config Firebase ---
        const myCustomConfig = {
            apiKey: "AIzaSyAyOP53ZNSmVLZkFt74O4GAxugyEXABdxI",
            authDomain: "nps2025-bb8fe.firebaseapp.com",
            projectId: "nps2025-bb8fe",
            storageBucket: "nps2025-bb8fe.firebasestorage.app",
            messagingSenderId: "608268194621",
            appId: "1:608268194621:web:fc42a7f3add4da6b122b54"
        };

        const app = initializeApp(myCustomConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'nps-expo-v2';

        let currentUser = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß)
        window.saveSurveyToCloud = async (data) => {
            if (!currentUser) throw new Error("‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà");
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Firestore
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'surveys'), {
                ...data, 
                timestamp: new Date().toISOString(), 
                userId: currentUser.uid,
                createdAt: new Date() // ‡πÄ‡∏û‡∏¥‡πà‡∏° Field ‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
            });
        };

        // [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà] ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° 6 ‡∏´‡∏•‡∏±‡∏Å (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏≠‡∏Ç‡∏ß‡∏î Transaction)
        window.generateCertNumber = () => {
            // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç 100000 - 999999
            const randomNum = Math.floor(100000 + Math.random() * 900000);
            return randomNum.toString(); 
        };

        // [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà] ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
        window.searchSurveyByName = async (nameQuery) => {
            if (!currentUser || !nameQuery) return [];
            
            // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö StartsWith ‡∏Ç‡∏≠‡∏á Firestore
            const surveysRef = collection(db, 'artifacts', appId, 'public', 'data', 'surveys');
            const q = query(
                surveysRef, 
                where('fullName', '>=', nameQuery),
                where('fullName', '<=', nameQuery + '\uf8ff'),
                limit(10) // ‡∏î‡∏∂‡∏á‡∏°‡∏≤‡πÅ‡∏Ñ‡πà 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
            );
            
            const querySnapshot = await getDocs(q);
            return querySnapshot.docs.map(doc => doc.data());
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin ‡∏ï‡∏≠‡∏ô Export)
        window.fetchAllSurveysForAdmin = async () => {
            if (!currentUser) return [];
            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'surveys'), orderBy('createdAt', 'desc'), limit(1000));
            const querySnapshot = await getDocs(q);
            return querySnapshot.docs.map(doc => doc.data());
        };

        onAuthStateChanged(auth, (user) => { currentUser = user; });
        signInAnonymously(auth).catch((error) => console.error("Auth Failed:", error));
    </script>

    <style>
        body { font-family: 'Prompt', sans-serif; background: linear-gradient(135deg, #0d47a1 0%, #000000 100%); min-height: 100vh; color: #ffffff; }
        .glass-morphism { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; }
        .header-gradient { background: linear-gradient(to right, #b3e5fc, #e1f5fe, #f9bdbb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .input-field { background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.2); color: white; border-radius: 12px; padding: 12px 16px; width: 100%; }
        .select-black option { color: black !important; }
        
        #cert-capture-area {
            width: 1122px; height: 794px; background: #fff; position: absolute; top: -9999px; left: -9999px; overflow: hidden;
        }
        .cert-inner {
            width: 1122px; height: 794px; position: relative;
            /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
            background-image: url('https://lh3.googleusercontent.com/d/1kdLdmkQ4wLihyNZ_04kcAx8vGDu_wYXP'); 
            background-size: 100% 100%; background-repeat: no-repeat;
        }

        /* ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠ */
        #display-name {
            position: absolute; top: 343px; left: 561px;
            transform: translate(-50%, -50%); 
            font-size: 42px; font-weight: 600; color: #d32f2f; text-align: center; width: 100%; white-space: nowrap;
        }

        /* ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà */
        #display-cert-id-wrapper {
            position: absolute; top: 73px; right: 38px;
            font-size: 14px; font-weight: 300; color: #000000; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏≥‡∏ñ‡πâ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß */
            text-align: right; display: flex; align-items: center; gap: 6px;
        }

        .rating-row { 
            display: grid; 
            grid-template-columns: 1fr 300px; 
            gap: 15px; 
            align-items: center; 
            padding: 12px 20px; 
            border-radius: 12px; 
            background: rgba(255, 255, 255, 0.04); 
            margin-bottom: 8px; 
        }
        .rating-options-container { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            text-align: center;
        }
        @media (max-width: 768px) { 
            .rating-row { grid-template-columns: 1fr; } 
            .rating-options-container { display: flex; justify-content: space-around; width: 100%; margin-top: 12px; } 
        }
        .radio-box input { width: 22px; height: 22px; cursor: pointer; accent-color: #b3e5fc; }
        .admin-table th { background: rgba(255,255,255,0.1); padding: 10px; text-align: left; font-size: 14px; color: #90caf9; }
        .admin-table td { border-bottom: 1px solid rgba(255,255,255,0.05); padding: 10px; font-size: 14px; }
    </style>
</head>
<body class="flex flex-col">

    <nav class="p-4 glass-morphism m-4 flex justify-between items-center sticky top-4 z-50">
        <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
            <span class="material-icons text-blue-300">stars</span>
            <span class="font-bold text-lg header-gradient">NPS Showcase Expo 2025</span>
        </div>
        <div class="flex gap-3">
            <button onclick="showSection('intro')" class="text-xs md:text-sm hover:text-blue-300">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
            <button onclick="showSection('search')" class="text-xs md:text-sm hover:text-blue-300">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</button>
            <button onclick="openAdmin()" class="text-xs md:text-sm text-yellow-300 border-l border-white/20 pl-3">Admin</button>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-2">
        
        <section id="intro-section" class="max-w-2xl mx-auto glass-morphism p-8">
            <div class="flex justify-center mb-6">
                <img src="https://lh3.googleusercontent.com/d/1q-rsEEwgM3OlXh7ClnWf1d-Rcm9P7f72" alt="School Logo" class="h-28 w-auto drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]">
            </div>
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold header-gradient mb-4">‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à NPS Showcase Expo 2025</h1>
                <p class="text-gray-300 text-sm">13 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2569 ‡∏ì ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡πâ‡∏≥‡∏û‡∏≠‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
            </div>
            <div class="space-y-6 mb-8 text-black">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xl text-blue-300 mb-2 font-bold">1. ‡πÄ‡∏û‡∏®</label>
                        <select id="user-gender" class="input-field select-black text-white py-3 text-lg"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option><option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option><option value="‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏£‡∏∞‡∏ö‡∏∏">‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏£‡∏∞‡∏ö‡∏∏</option></select>
                    </div>
                    <div>
                        <label class="block text-xl text-blue-300 mb-2 font-bold">2. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û</label>
                        <select id="user-status" class="input-field select-black text-white py-3 text-lg"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option><option value="‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</option><option value="‡∏Ñ‡∏£‡∏π‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏Ñ‡∏£‡∏π‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option><option value="‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option></select>
                    </div>
                </div>
            </div>
            <button onclick="validateIntro()" class="w-full bg-gradient-to-r from-blue-400 to-pink-300 text-blue-900 font-bold py-4 rounded-2xl text-lg hover:opacity-90 transition shadow-lg">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</button>
        </section>

        <section id="survey-section" class="hidden max-w-5xl mx-auto glass-morphism p-6">
            <div class="border-b border-white/10 pb-6 mb-4">
                <h2 class="text-xl md:text-2xl font-bold text-blue-200 mb-6 text-center leading-relaxed">3. ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô NPS Showcase Expo 2025</h2>
                
                <div class="bg-white/5 p-6 rounded-xl border border-white/10">
                    <div class="flex flex-col md:flex-row items-center justify-center gap-2 mb-6">
                        <span class="font-bold text-blue-300 text-lg border-r-2 border-blue-400/30 pr-4 hidden md:inline">‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á</span>
                        <span class="text-gray-200 text-base">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</span>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-y-3 gap-x-6 text-[15px] text-gray-300 max-w-4xl mx-auto border-t border-white/5 pt-4">
                        <div class="flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-blue-500/20 text-blue-300 flex items-center justify-center font-bold">5</span> = ‡∏û‡∏≠‡πÉ‡∏à‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                        <div class="flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-blue-500/20 text-blue-300 flex items-center justify-center font-bold">4</span> = ‡∏û‡∏≠‡πÉ‡∏à‡∏°‡∏≤‡∏Å</div>
                        <div class="flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-blue-500/20 text-blue-300 flex items-center justify-center font-bold">3</span> = ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</div>
                        <div class="flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-blue-500/20 text-blue-300 flex items-center justify-center font-bold">2</span> = ‡∏ô‡πâ‡∏≠‡∏¢</div>
                        <div class="flex items-center gap-2"><span class="w-6 h-6 rounded-full bg-blue-500/20 text-blue-300 flex items-center justify-center font-bold">1</span> = ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                    </div>
                </div>
            </div>
            
            <div id="survey-questions-list" class="space-y-2 mt-6"></div>
            
            <div class="pt-6 border-t border-white/10 space-y-6 mt-8">
                <h3 class="text-lg font-bold text-purple-300 pl-4 border-l-4 border-purple-400">4. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</h3>
                <div class="space-y-4">
                    <label class="block text-xl text-gray-300 font-bold">11. ‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà "‡∏ß‡πâ‡∏≤‡∏ß" ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∑‡∏≠</label>
                    <input type="text" id="wow-booth" class="input-field text-base py-3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏π‡∏ò‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...">
                    <label class="block text-xl text-gray-300 font-bold">12. ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤</label>
                    <textarea id="suggestions" class="input-field text-base h-24" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
                </div>
            </div>
            
            <div class="mt-10 flex justify-between">
                <button onclick="showSection('intro')" class="text-gray-400 hover:text-white transition">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
                <button onclick="validateSurvey()" class="bg-blue-600 px-12 py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-blue-500 transition">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            </div>
        </section>

        <section id="final-section" class="hidden max-w-md mx-auto glass-morphism p-8 text-center">
            <span class="material-icons text-6xl text-blue-300 mb-6">badge</span>
            <h2 class="text-2xl font-bold mb-8">‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</h2>
            <div class="text-left space-y-6 mb-8">
                <label class="block text-sm text-blue-300 font-bold">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏à‡∏£‡∏¥‡∏á</label>
                <input type="text" id="user-fullname" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" class="input-field text-xl py-4 text-center">
                <label class="block text-sm text-blue-300 font-bold">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</label>
                <input type="text" id="user-school" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≥‡∏û‡∏≠‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤" class="input-field text-xl py-4 text-center">
            </div>
            <button onclick="finishProcess()" class="w-full bg-green-500 font-bold py-5 rounded-2xl text-xl shadow-2xl transition transform active:scale-95">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</button>
        </section>

        <section id="result-section" class="hidden max-w-5xl mx-auto text-center pb-20">
            <div class="glass-morphism p-10 mb-10">
                <span class="material-icons text-7xl text-green-400 mb-4">verified</span>
                <h2 class="text-3xl font-bold mb-8">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</h2>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="downloadCertificate()" class="bg-green-600 text-white px-10 py-5 rounded-2xl font-bold shadow-2xl hover:scale-105 transition">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û (PNG)</button>
                    <button id="btn-back-to-admin" onclick="showSection('admin')" class="hidden bg-yellow-600 text-white px-10 py-5 rounded-2xl font-bold shadow-2xl transition">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Admin</button>
                </div>
            </div>
            <div id="preview-display-container" class="mt-8 flex justify-center p-4 bg-gray-900/40 rounded-3xl border border-white/5"></div>
        </section>

        <section id="search-section" class="hidden max-w-2xl mx-auto glass-morphism p-8 text-center">
            <h2 class="text-2xl font-bold mb-6 text-blue-200">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</h2>
            <div class="flex gap-2 mb-8"><input type="text" id="search-query" class="input-field flex-grow text-white text-center" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á..."><button onclick="doSearch()" class="bg-blue-600 px-8 rounded-xl font-bold">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button></div>
            <div id="search-results-area" class="hidden overflow-x-auto bg-black/40 rounded-2xl border border-white/10 max-h-[400px]"><table class="admin-table w-full"><thead class="sticky top-0 bg-gray-900 text-white"><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏î‡∏π‡∏†‡∏≤‡∏û</th></tr></thead><tbody id="search-data-body"></tbody></table></div>
            <button onclick="showSection('intro')" class="text-gray-400 mt-8 hover:text-white">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
        </section>

        <section id="admin-section" class="hidden max-w-6xl mx-auto glass-morphism p-8">
            <div class="flex justify-between items-center mb-8"><h2 class="text-xl font-bold text-yellow-300">üìä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</h2><div class="flex gap-2"><button onclick="exportToCSV()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-xs">Excel (CSV)</button><button onclick="showSection('intro')" class="bg-white/10 text-white px-4 py-2 rounded-lg text-xs">‡∏õ‡∏¥‡∏î</button></div></div>
            <div class="overflow-x-auto bg-black/40 rounded-2xl border border-white/10 max-h-[500px]"><table class="admin-table w-full"><thead class="sticky top-0 bg-gray-900 text-white"><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="admin-data-body"></tbody></table></div>
        </section>

    </main>

    <div id="cert-capture-area"><div class="cert-inner"><div id="display-cert-id-wrapper"><span>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</span><span id="display-cert-id"></span></div><div id="display-name"></div></div></div>

    <footer class="p-4 text-center text-[10px] border-t border-white/10 text-gray-400">¬© 2025 Power AI ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡πâ‡∏≥‡∏û‡∏≠‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤ :By KOTCHA</footer>

    <script>
        const surveyQuestions = [
            "1. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤‡∏á ‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏ö‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏ö‡∏π‡∏ò‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢",
            "2. ‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏Å‡∏•",
            "3. ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°",
            "4. ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡πÜ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏°‡∏≤‡∏à‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à",
            "5. ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏π‡∏ò‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏à",
            "6. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏ô‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ",
            "7. ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡∏î‡∏π‡∏™‡∏∞‡∏≠‡∏≤‡∏î ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à",
            "8. ‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏£‡∏¥‡∏á‡πÜ",
            "9. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢ \"‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢‡∏ù‡∏±‡∏ô\" ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏ï‡∏ô‡πÄ‡∏≠‡∏á",
            "10. ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á"
        ];

        function buildSurvey() {
            const container = document.getElementById('survey-questions-list');
            if(!container) return;
            container.innerHTML = surveyQuestions.map((q, i) => `
                <div class="rating-row">
                    <div class="text-[15px] md:text-[18px] font-normal text-gray-100 pr-2">${q}</div>
                    <div class="rating-options-container">
                        ${[5,4,3,2,1].map(v => `
                            <label class="radio-box">
                                <input type="radio" name="q_${i}" value="${v}">
                                <span class="text-[12px] font-bold text-gray-400 mt-1">${v}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>`).join('');
        }

        function showSection(id) {
            ['intro', 'survey', 'final', 'admin', 'result', 'search'].forEach(s => {
                const el = document.getElementById(`${s}-section`);
                if(el) el.classList.add('hidden');
            });
            const target = document.getElementById(`${id}-section`);
            if(target) target.classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function validateIntro() {
            if(!document.getElementById('user-gender').value || !document.getElementById('user-status').value) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏® ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö', 'warning');
            buildSurvey(); showSection('survey');
        }

        function validateSurvey() {
            let ok = true;
            surveyQuestions.forEach((_, i) => { if(!document.querySelector(`input[name="q_${i}"]:checked`)) ok = false; }); 
            if(!ok) return Swal.fire('‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 10 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö', 'info');
            showSection('final');
        }

        async function finishProcess() {
            const name = document.getElementById('user-fullname').value.trim();
            const school = document.getElementById('user-school').value.trim();
            if(!name || !school) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö', 'warning');
            
            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
            
            try {
                // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ó‡∏ô‡πÄ‡∏•‡∏Ç‡∏£‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞
                const no = window.generateCertNumber(); 
                
                const results = {};
                surveyQuestions.forEach((q, i) => { results[q] = document.querySelector(`input[name="q_${i}"]:checked`)?.value; });
                
                await window.saveSurveyToCloud({ 
                    fullName: name, 
                    school, 
                    gender: document.getElementById('user-gender').value, 
                    status: document.getElementById('user-status').value, 
                    certNo: no, 
                    results, 
                    wowBooth: document.getElementById('wow-booth').value, 
                    suggestion: document.getElementById('suggestions').value 
                });
                
                await generateAndShowPreview(name, no, false);
                Swal.close();
            } catch (error) { 
                Swal.fire({ icon: 'error', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', text: error.message }); 
            }
        }

        async function generateAndShowPreview(name, no, fromAdmin = true) {
            document.getElementById('display-name').innerText = name;
            document.getElementById('display-cert-id').innerText = no;
            
            showSection('result');
            if(fromAdmin) { document.getElementById('btn-back-to-admin').classList.remove('hidden'); } 
            else { document.getElementById('btn-back-to-admin').classList.add('hidden'); }

            await new Promise(r => setTimeout(r, 1200));
            const captureArea = document.getElementById('cert-capture-area');
            const canvas = await html2canvas(captureArea, { scale: 2, useCORS: true, backgroundColor: null, width: 1122, height: 794, scrollX: 0, scrollY: 0, x: 0, y: 0, logging: false });
            const previewImg = new Image(); previewImg.src = canvas.toDataURL('image/png'); previewImg.className = "max-w-full h-auto rounded-lg shadow-2xl";
            const container = document.getElementById('preview-display-container'); container.innerHTML = ''; container.appendChild(previewImg);
        }

        async function doSearch() {
            const queryText = document.getElementById('search-query').value.trim();
            if(!queryText) return Swal.fire('‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö', 'info');
            
            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...', didOpen: () => Swal.showLoading() });
            
            try {
                // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà
                const filtered = await window.searchSurveyByName(queryText);
                
                if(filtered.length > 0) {
                    document.getElementById('search-data-body').innerHTML = filtered.map(d => `<tr><td>${d.certNo}</td><td class="text-white">${d.fullName}</td><td>${d.school}</td><td><button onclick="generateAndShowPreview('${d.fullName}', '${d.certNo}', false)" class="bg-blue-600 p-1 rounded text-white"><span class="material-icons text-sm">visibility</span></button></td></tr>`).join('');
                    document.getElementById('search-results-area').classList.remove('hidden'); 
                    Swal.close();
                } else { Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö', 'error'); }
            } catch (e) { 
                console.error(e);
                Swal.fire('Error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠', 'error'); 
            }
        }

        async function openAdmin() {
            const pin = await Swal.fire({ title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Admin', input: 'password', confirmButtonColor: '#0d47a1' });
            if (pin.value !== '1234') return;
            
            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...', didOpen: () => Swal.showLoading() });
            // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin
            const data = await window.fetchAllSurveysForAdmin();
            
            if(data.length > 0) {
                document.getElementById('admin-data-body').innerHTML = data.map(d => `<tr><td>${d.certNo}</td><td class="text-white">${d.fullName}</td><td>${d.school}</td><td><button onclick="generateAndShowPreview('${d.fullName}', '${d.certNo}', true)" class="bg-blue-600 p-1 rounded text-white"><span class="material-icons text-sm">visibility</span></button></td></tr>`).join('');
            } else { document.getElementById('admin-data-body').innerHTML = '<tr><td colspan="4" class="text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>'; }
            Swal.close(); showSection('admin');
        }

        async function exportToCSV() {
            const data = await window.fetchAllSurveysForAdmin();
            if (data.length === 0) return Swal.fire('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°', 'info');
            
            let headers = ["‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà", "‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "‡πÄ‡∏û‡∏®", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û"];
            surveyQuestions.forEach(q => headers.push(q));
            headers.push('11. ‡∏ö‡∏π‡∏ò‡∏ó‡∏µ‡πà "‡∏ß‡πâ‡∏≤‡∏ß" ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∑‡∏≠', "12. ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");

            let csvContent = "\uFEFF" + headers.map(h => `"${h}"`).join(",") + "\n";
            data.forEach(d => {
                let row = [`${d.certNo}`, `"${d.fullName}"`, `"${d.school}"`, `"${d.gender}"`, `"${d.status}"`];
                surveyQuestions.forEach(q => {
                    row.push(`"${d.results ? d.results[q] : '-'}"`);
                });
                row.push(`"${d.wowBooth || '-'}"`, `"${d.suggestion || '-'}"`, `"${d.timestamp}"`);
                csvContent += row.join(",") + "\n";
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = `Report_NPS_Expo_2025_Complete.csv`; link.click();
        }

        async function downloadCertificate() {
            const previewImg = document.querySelector('#preview-display-container img');
            if(!previewImg) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£', 'error');
            const link = document.createElement('a'); link.download = `Cert_${document.getElementById('display-name').innerText}.png`; link.href = previewImg.src; link.click();
        }

        document.addEventListener('DOMContentLoaded', buildSurvey);
    </script>
</body>

</html>
